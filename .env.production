# ============================================
# RSS Skull Bot - Configuração de Produção Otimizada
# ============================================
# Esta configuração foi otimizada especificamente para resolver
# os problemas de conectividade 502 Bad Gateway que você estava enfrentando

# Bot Configuration
BOT_TOKEN=8429360941:AAElfcU-BKfnuPyLkoUhz3ouCkeRRTTWNpY

# Server Configuration
PORT=8916
HOST=0.0.0.0

# Database Configuration
DATABASE_URL=file:/app/data/production.db

# Redis Configuration
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
DISABLE_REDIS=false

# Application Configuration
NODE_ENV=production
LOG_LEVEL=info

# Access Control
ALLOWED_USER_ID=594484452

# ============================================
# Reddit API Configuration
# ============================================
REDDIT_CLIENT_ID=VBAIZccnQaBKEmp2sWT60g
REDDIT_CLIENT_SECRET=uikrnqlueH6AhGaL2HAELW_q1gqDDw
REDDIT_USERNAME=rasputinixx
REDDIT_PASSWORD=Driver2136

# Feature Flags
USE_REDDIT_API=true
USE_REDDIT_JSON_FALLBACK=true
FEATURE_INSTAGRAM=false

# ============================================
# SISTEMA DE RESILIÊNCIA - CONFIGURAÇÃO OTIMIZADA
# ============================================

# Habilita o sistema completo de resiliência
TELEGRAM_RESILIENCE_ENABLED=true

# ============================================
# Configuração de Retry (Especial para 502 Errors)
# ============================================
# Configuração agressiva para lidar com os erros 502 que você estava enfrentando
TELEGRAM_MAX_RETRIES=15          # 15 tentativas (vs 10 padrão)
TELEGRAM_BASE_DELAY=800          # Começa com 800ms (mais rápido)
TELEGRAM_MAX_DELAY=45000         # Máximo 45s (vs 60s padrão)

# ============================================
# Circuit Breaker (Mais Sensível)
# ============================================
# Configuração mais sensível para detectar problemas rapidamente
TELEGRAM_CIRCUIT_BREAKER_THRESHOLD=3     # Abre após 3 falhas (vs 5 padrão)
TELEGRAM_CIRCUIT_BREAKER_TIMEOUT=120000  # 2 minutos para tentar novamente

# ============================================
# Fila de Mensagens (Capacidade Aumentada)
# ============================================
MESSAGE_QUEUE_ENABLED=true
MESSAGE_QUEUE_MAX_SIZE=2000      # 2000 mensagens (vs 1000 padrão)
MESSAGE_QUEUE_BATCH_SIZE=12      # 12 por batch (vs 20 padrão) - mais conservador
MESSAGE_QUEUE_PROCESSING_INTERVAL=3500  # A cada 3.5 segundos
MESSAGE_QUEUE_MESSAGE_TTL=10800000  # 3 horas de TTL (vs 1 hora padrão)

# ============================================
# Monitoramento Intensivo
# ============================================
HEALTH_CHECK_INTERVAL=15000      # Verifica a cada 15 segundos
ALERT_THRESHOLD_ERROR_RATE=0.03  # Alerta com 3% de erro (muito sensível)
ALERT_THRESHOLD_DOWNTIME_MINUTES=3  # Alerta após 3 minutos
ALERT_THRESHOLD_QUEUE_SIZE=200   # Alerta com 200 mensagens na fila

# ============================================
# Configurações de Performance
# ============================================
# Otimizações específicas para seu ambiente
MAX_FEEDS_PER_CHAT=100          # Limite generoso
CACHE_TTL_MINUTES=12            # Cache mais agressivo
MIN_DELAY_MS=120000             # 2 minutos entre requests (mais conservador)

# ============================================
# LOGS DETALHADOS (para monitoramento)
# ============================================
# Mantém info para ver os logs de recuperação sem spam
LOG_LEVEL=info

# ============================================
# NOTAS DE CONFIGURAÇÃO
# ============================================
# Esta configuração foi otimizada para:
# 1. Detectar problemas 502 rapidamente (circuit breaker em 3 falhas)
# 2. Tentar recuperação mais agressiva (15 tentativas, delays menores)
# 3. Manter mais mensagens na fila durante outages (2000 vs 1000)
# 4. Processar mensagens mais conservadoramente (12 por batch vs 20)
# 5. Alertar mais cedo sobre problemas (3% error rate vs 10%)
# 
# Monitoramento:
# - http://localhost:8916/health - Status geral
# - http://localhost:8916/resilience-stats - Estatísticas detalhadas
# - http://localhost:8916/metrics - Métricas completas
#
# Os logs mostrarão:
# [INFO] Telegram error handled by resilience system
# [WARN] Circuit breaker opened after 3 failures  
# [INFO] Message enqueued for retry
# [INFO] Connection recovered from downtime